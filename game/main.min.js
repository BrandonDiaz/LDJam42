function gameLoop(){if(in_game&&($("#weight").text(weight+"/75 lbs"),weight>=50?weight>=75?endGame():$("#weight").addClass("danger"):$("#weight").removeClass("danger"),is_moving&&drone.move(drone.facing),next_drop<=Date.now())){var t=1+Math.floor(3*Math.random());next_drop=Date.now()+250*(11-level);for(var e=0;e<t;e++){spawnEntity(facilities[Math.floor(Math.random()*facilities.length)].accepts)}}}function showScreen(t){$("[screen]").addClass("inactive"),$('[screen="'+t+'"]').removeClass("inactive")}function showTip(t){$("#tips").append('<span class="tip">'+t+"</span>")}function startGame(){level=1,next_drop=Date.now()+5e3,generateWorld(),showTip("Use [W][S][A][D] or the Arrow keys to move your drone"),in_game=!0}function endGame(){var t=["F","D","C","B","A"],e=0;in_game=!1,showScreen("gameover"),points>=30&&e++,points>=60&&e++,timer>=120&&e++,timer>=180&&e++,$("#points span").text(points),$("#grade span").text(t[e]),$("#time span").text(("00"+Math.floor(timer/60)).slice(-2)+":"+("00"+(timer%60?timer%60:"00")).slice(-2))}function generateWorld(){var t=$("#map");t.css({height:48*MAX_Y+"px",perspective:48*MAX_X*2+"px",width:48*MAX_X+"px"}),t.find("#scene").append('<entity type="drone" x="'+drone.x+'" y="'+drone.y+'" facing="2"><div class="wrapper"><div class="left"></div><div class="right"></div><div class="front"></div><div class="back"></div><div class="top"></div></div></entity>')}function spawnEntity(t){var e=$("#map"),i=Math.floor(Math.random()*MAX_X),n=Math.floor(Math.random()*MAX_Y),a=1;if(isBlocked(i,n)){if(!t.startsWith("trash-"))return spawnEntity(t);if(!(trash[i+"."+n]&&trash[i+"."+n].length&&trash[i+"."+n].length<4))return spawnEntity(t);trash[i+"."+n].push(t),a+=trash[i+"."+n].length-1,weight++}else t.startsWith("trash-")&&(trash[i+"."+n]?trash[i+"."+n].push(t):trash[i+"."+n]=[t],a+=trash[i+"."+n].length-1,weight++);t.startsWith("facility-")&&facilities.push({type:t,accepts:t.replace("facility-","trash-"),x:i,y:n,queue:0}),e.find("#scene").append('<entity type="warning" x="'+i+'" y="'+n+'">!</entity>'),setTimeout(function(){$('entity[type="warning"][x="'+i+'"][y="'+n+'"]').remove(),e.find("#scene").append('<entity type="'+t+'" x="'+i+'" y="'+n+'" z="'+a+'"></entity>')},5500)}function isBlocked(t,e){var i=!1;return drone.x==t&&drone.y==e&&(i=!0),trash[t+"."+e]&&trash[t+"."+e].length&&(i=!0),facilities.forEach(function(n){n.x==t&&n.y==e&&(i=!0)}),i}const DOWN=2,LEFT=3,RIGHT=1,UP=0,MAX_X=16,MAX_Y=10,TIPS={10:"Pick up waste with [SPACE], drop them off at the matching facility with [SPACE]",20:"Waste storage is first in, last out. Plan accordingly.",30:"Your drone can only hold 8 items in storage at a time.",60:"If the facility floor exceeds the weight limit, the evaluation is terminated.",90:"The evaluation is nearly complete, good luck."};in_game=!1,is_moving=!1,level=1,timer=0,weight=0,points=0,next_drop=null,next_trash=["glass","plastic","metal"].sort(function(){return Math.random()-.5}),facilities=[],trash={},drone={x:Math.floor(MAX_X/2),y:Math.floor(MAX_Y/2),moved:0,facing:0,cargo:[],interact:function(){var t=this.x,e=this.y;if(0==this.facing?e--:1==this.facing?t++:2==this.facing?e++:3==this.facing&&t--,drone.cargo.length<8&&trash[t+"."+e]&&trash[t+"."+e][0]){var i=trash[t+"."+e].slice(-1)[0],n=trash[t+"."+e].length;if($('entity[type="warning"][x="'+t+'"][y="'+e+'"]').length||!$('entity[type="'+i+'"][x="'+t+'"][y="'+e+'"][z="'+n+'"]').length)return!1;weight--,this.cargo.push(trash[t+"."+e].pop()),$('entity[type="'+i+'"][x="'+t+'"][y="'+e+'"][z="'+n+'"]').remove(),$("#cargo").append('<li type="'+this.cargo.slice(-1)+'"></li>'),$(".highlighted").removeClass("highlighted"),$('[type="'+i.replace("trash-","facility-")+'"]').addClass("highlighted")}facilities.forEach(function(i){if(i.x==t&&i.y==e&&i.accepts==drone.cargo.slice(-1)[0]&&(drone.cargo.pop(),points++,$("#cargo li").last().remove(),$(".highlighted").removeClass("highlighted"),drone.cargo.length)){var n=drone.cargo.slice(-1)[0];$('[type="'+n.replace("trash-","facility-")+'"]').addClass("highlighted")}})},rotate:function(t){drone.facing=t,$('entity[type="drone"]').attr("facing",drone.facing)},move:function(t){this.canMove()&&(0==t?this.y-1>=0&&!isBlocked(this.x,this.y-1)&&(this.y--,this.moved=Date.now()):1==t?this.x+1<MAX_X&&!isBlocked(this.x+1,this.y)&&(this.x++,this.moved=Date.now()):2==t?this.y+1<MAX_Y&&!isBlocked(this.x,this.y+1)&&(this.y++,this.moved=Date.now()):3==t&&this.x-1>=0&&!isBlocked(this.x-1,this.y)&&(this.x--,this.moved=Date.now()),$('entity[type="drone"]').attr("x",this.x).attr("y",this.y))},canMove:function(){return this.moved+140<=Date.now()}},$(document).ready(function(){$('[screen="menu"] .button').on("click",function(){showScreen("intro"),setTimeout(function(){showScreen("game"),startGame()},6e3)}),$('[screen="gameover"] .button').on("click",function(){window.location.reload()}),$("body").on("keydown",function(t){if(!in_game)return!1;switch(t.which){case 40:case 83:drone.rotate(2),is_moving=!0;break;case 37:case 65:drone.rotate(3),is_moving=!0;break;case 39:case 68:drone.rotate(1),is_moving=!0;break;case 38:case 87:drone.rotate(0),is_moving=!0;break}}).on("keyup",function(){is_moving=!1}).on("keypress",function(t){32==t.which&&drone.interact()}),setInterval(function(){gameLoop()},50),setInterval(function(){in_game&&(timer++,TIPS[timer]&&showTip(TIPS[timer]),level=Math.min(10,Math.floor(timer/60)),5!=timer&&30!=timer&&90!=timer&&180!=timer||next_trash.length&&spawnEntity("facility-"+next_trash.pop()),$("#timer").text(("00"+Math.floor(timer/60)).slice(-2)+":"+("00"+(timer%60?timer%60:"00")).slice(-2)))},1e3)});
//# sourceMappingURL=./main.min.js.map